# Wolpertinger


## JSON API

Wolpertinger exposes a JSON-based REST API that enables censorship measurement
clients like OONI to retrieve Tor bridges to probe.

### Input

Wolpertinger takes as input HTTP POST requests carrying the following JSON:

      {
        "id": "ID",
        "type": "TYPE",
        "country_code": "COUNTRY_CODE",
        "auth_token": "AUTH_TOKEN"
      }

* `ID` is a string that uniquely identifies the client.  If the requesting
  client has no unique ID, use an empty string instead.

* `TYPE` is a string that identifies the type of client that's asking for
  bridges to probe (e.g., "ooni").  Please talk to us if
  you intend to use wolpertinger, and we will assign you a type string.

* `COUNTRY_CODE` is a string that contains a ISO 3166-1 alpha-2 country code of
  the client sending the request (e.g., "be" for Belgium).

* `AUTH_TOKEN` is a string that contains a Base64-encoded 32-byte
  authentication token, which must be generated by a CSPRNG (e.g.,
  "SmNnMefnjWHNvTWnyo4V8V654qJj/wAOwMYYrYF5dyY=").  When assigning you a type
  string, we will also provide you with an authentication token.

### Output

Wolpertinger responds with the following JSON structure:

      {
        "BRIDGE_ID": {
          "fingerprint": "FINGERPRINT",
          "type": "TYPE"
          "address": "ADDRESS",
          "port": PORT,
          "protocol": "PROTOCOL",
          "arguments": {
              "KEY": "VALUE",
              ...
          },
        },
        ...
      }

* `BRIDGE_ID` is a string that uniquely identifies a bridge.  It is a HMAC over
  a bridge's address, protocol, and port (e.g.,
  "b8ac3f413663f3ed3a404a5db8b1445c8c1b37f85849879feb3b1b03ce8cb6d8").

* `FINGERPRINT` contains the bridge's fingerprint, a 40-character, hex-encoded
  string (e.g., "1234567890ABCDEF1234567890ABCDEF12345678").

* `TYPE` is a string that determines the bridge's type (e.g., "vanilla" or
  "obfs4").

* `ADDRESS` is a string that contains the bridge's IPv4 or IPv6 address (e.g.,
  "8.8.8.8" or "2001:4860:4860::8888").

* `PORT` represents the bridge's port as integer (e.g., 8080).

* `PROTOCOL` is a string that contains the bridge's protocol (e.g., "tcp" or
  "udp").

* The strings `KEY` and `VALUE` constitute a dictionary that – for obfuscated
  bridges – contains a bridge's arguments (e.g., "cert":
  "VBYOXYf+SbRu2dCHJkLuL9y7YX4IWhucHGg3ES+l/KKxe3KL+zhCHr5hRqgSE6w80bZvCA").
  Unobfuscated bridges (i.e., bridges whose type is "vanilla") don't have the
  "arguments" key.

Here is an example of a JSON response, consisting of two bridges:

      {
        "b8ac3f413663f3ed3a404a5db8b1445c8c1b37f85849879feb3b1b03ce8cb6d8": {
          "address": "2001:4860:4860::8888",
          "arguments": {
            "cert": "VBYOXYf+SbRu2dCHJkLuL9y7YX4IWhucHGg3ES+l/KKxe3KL+zhCHr5hRqgSE6w80bZvCA",
            "iat-mode": "0"
          },
          "fingerprint": "1234567890ABCDEF1234567890ABCDEF12345678",
          "port": 80,
          "protocol": "tcp",
          "type": "obfs4"
        },
        "e26e08e6391a18a02387327798bb7c7d3d7aede04517408b082cec6de9dc40c1": {
          "address": "1.2.3.4",
          "fingerprint": "1234567890ABCDEF1234567890ABCDEF12345678",
          "port": 443,
          "protocol": "tcp",
          "type": "vanilla"
        }
      }

## Contact

Send email to Philipp Winter <phw@torproject.org>.
